{% extends "base.html" %}

{% block content %}
<div class="max-w-4xl mx-auto bg-white shadow-md rounded-2xl p-8 mt-8">

  <!-- FOTO + INFO -->
  <div class="flex flex-col sm:flex-row items-center gap-6 mb-8">
    <img src="{{ url_for('static', filename=(utente['foto_profilo'] or 'img/user_default.png')) }}"
         alt="Foto profilo"
         class="w-32 h-32 rounded-full object-cover border-2 border-blue-100 shadow-sm">
    <div class="text-center sm:text-left">
      <h1 class="text-2xl font-bold text-blue-700 mb-1">
        {{ utente['nome'] }} {{ utente['cognome'] }}
      </h1>
      <p class="text-gray-600 text-sm">@{{ utente['username'] }}</p>
      {% if utente['citta'] %}
        <p class="text-gray-500 text-sm mt-1">ğŸ“ {{ utente['citta'] }}</p>
      {% endif %}


      <!-- â­ MEDIA RECENSIONI -->
      {% if totale > 0 %}
      <p class="text-yellow-500 font-semibold mt-2 flex items-center gap-1">
        â­ <span class="text-gray-800">{{ "%.1f"|format(media) }}</span>
        <span class="text-gray-500 text-sm">({{ totale }} recension{{ 'e' if totale == 1 else 'i' }})</span>
      </p>
      {% else %}
        <p class="text-gray-400 text-sm mt-2 italic">Nessuna recensione disponibile</p>
      {% endif %}

      <!-- ğŸ”— LINK RECENSIONI -->
      <a href="{{ url_for('recensioni_utente', user_id=utente['id']) }}" class="text-blue-600 hover:underline">
        âœï¸ Vedi o lascia una recensione
      </a>

      <!-- ğŸ’¬ PULSANTE MESSAGGIO -->
      {% if g.utente and g.utente['id'] != utente['id'] %}
        <a href="{{ url_for('chat_conversazione_view', other_id=utente['id']) }}"
           class="inline-flex items-center gap-2 bg-blue-500 text-white px-4 py-2 rounded-xl mt-4 hover:bg-blue-600 transition">
           ğŸ’¬ Scrivi un messaggio
        </a>
      {% elif not g.utente %}
        <a href="{{ url_for('login') }}"
           class="inline-flex items-center gap-2 bg-gray-300 text-gray-700 px-4 py-2 rounded-xl mt-4 hover:bg-gray-400 transition">
           ğŸ”’ Accedi per scrivere
        </a>
      {% endif %}
    </div>
  </div>

  <!-- ANNUNCI PUBBLICATI -->
  {% if annunci %}
    <h2 class="text-xl font-semibold text-gray-800 mb-4">Annunci pubblicati</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
      {% for a in annunci %}
        <div class="border border-gray-200 rounded-xl p-4 shadow-sm hover:shadow-md transition bg-gray-50">
          <h3 class="font-semibold text-gray-900">{{ a['titolo'] }}</h3>
          {% if a['descrizione'] %}
            <p class="text-sm text-gray-700 line-clamp-3 mt-1">{{ a['descrizione'] }}</p>
          {% endif %}
          {% if a['bio_utente'] %}
            <p class="text-xs text-gray-600 mt-1 italic">â€œ{{ a['bio_utente'] }}â€</p>
          {% endif %}
          {% if a['filtri_categoria'] %}
            <div class="flex flex-wrap gap-1 mt-2">
              {% for f in a['filtri_categoria'].split(',') if f.strip() %}
                <span class="bg-blue-50 text-blue-700 text-xs font-semibold px-2 py-0.5 rounded-full border border-blue-200">{{ f.strip() }}</span>
              {% endfor %}
            </div>
          {% endif %}
          <a href="{{ url_for('visualizza_annuncio_pubblico', id=a['id']) }}"
             class="text-blue-600 text-sm font-medium hover:underline mt-3 inline-block">ğŸ”— Vedi annuncio</a>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-gray-500 text-center italic">Questo utente non ha ancora pubblicato annunci.</p>
  {% endif %}
</div>

{% endblock %}
