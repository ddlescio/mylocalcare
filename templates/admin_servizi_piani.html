{% extends "layout_admin.html" %}
{% set body_class = "offset-navbar" %}

{% block admin_content %}
<div class="max-w-4xl mx-auto">

  <!-- HEADER -->
  <div class="flex items-center justify-between mb-6">
    <div>
      <h1 class="text-2xl font-bold text-slate-900">
        üí∞ Piani ‚Äì {{ servizio.nome }}
      </h1>
      <p class="text-slate-600 text-sm mt-1">
        Configura durate e prezzi acquistabili dagli utenti
      </p>
    </div>

    <a href="{{ url_for('admin_servizi') }}"
       class="px-4 py-2 rounded-xl bg-slate-100 text-slate-700 hover:bg-slate-200">
      ‚Üê Servizi
    </a>
  </div>

  <!-- AZIONI -->
  <div class="mb-6">
    <a href="{{ url_for('admin_servizi_piani_nuovo', servizio_id=servizio.id) }}"
       class="inline-flex items-center gap-2 px-4 py-2 rounded-xl
              bg-emerald-600 text-white hover:bg-emerald-700">
      ‚ûï Nuovo piano
    </a>
  </div>

  {% if piani %}
    <div class="space-y-4">

      {% for p in piani %}
        <div class="border rounded-2xl p-4
                    {% if not p.attivo %}opacity-50{% endif %}
                    {% if p.evidenziato %}border-amber-300 bg-amber-50/60{% else %}border-slate-200 bg-white{% endif %}">

          <div class="flex items-start justify-between gap-4">
            <div>
              <div class="flex items-center gap-2 flex-wrap">
                <h3 class="font-semibold text-slate-900">
                  {{ p.nome }}
                </h3>

                {% if p.consigliato %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-blue-100 text-blue-700">
                    ‚≠ê Consigliato
                  </span>
                {% endif %}

                {% if p.evidenziato %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-amber-100 text-amber-700">
                    üçø Evidenziato
                  </span>
                {% endif %}

                {% if not p.attivo %}
                  <span class="text-xs px-2 py-0.5 rounded-full bg-slate-200 text-slate-600">
                    Disattivo
                  </span>
                {% endif %}
              </div>

              {% if p.descrizione %}
                <p class="text-sm text-slate-600 mt-1">
                  {{ p.descrizione }}
                </p>
              {% endif %}

              <div class="mt-2 text-sm text-slate-700">
                ‚è± {{ p.durata_giorni }} giorni ¬∑
                üí∂ {{ "%.2f"|format(p.prezzo_cent / 100) }} ‚Ç¨
              </div>
            </div>

            <!-- AZIONI -->
            <div class="flex flex-col gap-2">
              <a href="{{ url_for('admin_servizi_piani_modifica', piano_id=p.id) }}"
                 class="px-3 py-1.5 rounded-lg text-sm bg-slate-100 hover:bg-slate-200">
                ‚úèÔ∏è Modifica
              </a>

              <a href="{{ url_for('admin_servizi_piani_toggle', piano_id=p.id) }}"
                 class="px-3 py-1.5 rounded-lg text-sm
                        {% if p.attivo %}
                          bg-red-100 text-red-700 hover:bg-red-200
                        {% else %}
                          bg-emerald-100 text-emerald-700 hover:bg-emerald-200
                        {% endif %}">
                {% if p.attivo %}Disattiva{% else %}Attiva{% endif %}
              </a>
            </div>
          </div>

        </div>
      {% endfor %}

    </div>
  {% else %}
    <div class="bg-slate-50 border border-slate-200 rounded-2xl p-6 text-center">
      <p class="text-slate-600">
        Nessun piano configurato per questo servizio.
      </p>
    </div>
  {% endif %}

</div>
{% endblock %}
